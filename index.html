<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Comisión</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f4f6f9; }
    form { background: #fff; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto;
           box-shadow: 0px 2px 8px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { margin-top: 20px; padding: 12px; width: 100%; background: #1976d2; color: white; border: none;
             border-radius: 5px; font-size: 16px; cursor: pointer; }
    button:hover { background: #1565c0; }
  </style>
</head>
<body>
  <h2>Formulario de Comisión</h2>
  <form id="comisionForm">
    <label>Número de Oficio</label>
    <input type="text" name="numeroOficio" required list="historialOficio">
    <datalist id="historialOficio"></datalist>

    <label>Fecha Oficio</label>
    <input type="date" name="fecha" id="fechaActual" required>

    <label>Lugar de Comisión</label>
    <select name="lugar" id="lugarSelect" required>
      <option value="">-- Selecciona un lugar --</option>
    </select>

    <label>Fecha de Comisión</label>
    <input type="date" name="fechaC" id="fechaComision" required>

    <label>Nombre</label>
    <input type="text" name="nombre" required list="historialNombre">
    <datalist id="historialNombre"></datalist>

    <label>Puesto</label>
    <input type="text" name="puesto" required list="historialPuesto">
    <datalist id="historialPuesto"></datalist>

    <label>Quién Autoriza</label>
    <input type="text" name="autoriza" required list="historialAutoriza">
    <datalist id="historialAutoriza"></datalist>

    <label>Puesto de Quién Autoriza</label>
    <input type="text" name="puestoAutoriza" required list="historialPuestoAutoriza">
    <datalist id="historialPuestoAutoriza"></datalist>

    <label>Motivo de Comisión</label>
    <textarea name="motivo" rows="3" required></textarea>

    <button type="submit">Enviar</button>
  </form>

  <script>
    // ⚡ URL del WebApp desplegado (Apps Script)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxZ5XDxo_vbKGHS-ATy-PIfx6R4WzYzo5Llar1qHUmWuvBDRu0V0X3SJbQhYxwgpy5rqQ/exec";

    // ⚡ Cargar municipios desde municipios.txt
    fetch("municipios.txt")
      .then(res => res.text())
      .then(text => {
        const municipios = text.split("\n").map(m => m.trim()).filter(m => m);
        const select = document.getElementById("lugarSelect");
        municipios.forEach(m => {
          let opt = document.createElement("option");
          opt.value = m;
          opt.textContent = m;
          select.appendChild(opt);
        });
      });

    // ⚡ Fecha actual en campo de fecha
    const hoy = new Date().toISOString().split("T")[0];
document.getElementById("fechaActual").value = hoy;
document.getElementById("fechaComision").value = hoy;


  // Guardar datos en Google Sheets
    document.getElementById("comisionForm").addEventListener("submit", e => {
      e.preventDefault();
      const formData = new FormData(e.target);
      fetch(SCRIPT_URL, { method: "POST", body: formData })
        .then(res => res.text())
        .then(() => {
          alert("✅ Datos guardados");
          e.target.reset();
          document.getElementById("fechaActual").value = hoy;
          document.getElementById("fechaComision").value = hoy;
          cargarHistorial(); // recarga historial
        })
        .catch(err => alert("Error: " + err));
    });

    // Mostrar historial
    function cargarHistorial() {
      fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
          const thead = document.querySelector("#historialTable thead");
          const tbody = document.querySelector("#historialTable tbody");
          thead.innerHTML = "";
          tbody.innerHTML = "";

          if (data.length > 0) {
            // encabezados
            const headers = Object.keys(data[0]);
            const trHead = document.createElement("tr");
            headers.forEach(h => {
              const th = document.createElement("th");
              th.textContent = h;
              trHead.appendChild(th);
            });
            thead.appendChild(trHead);

            // filas
            data.forEach(row => {
              const tr = document.createElement("tr");
              headers.forEach(h => {
                const td = document.createElement("td");
                td.textContent = row[h] || "";
                tr.appendChild(td);
              });
              tbody.appendChild(tr);
            });
          } else {
            tbody.innerHTML = "<tr><td colspan='10'>Sin registros aún</td></tr>";
          }
        })
        .catch(err => console.error("Error al cargar historial:", err));
    }

    // ⚡ Cargar historial al iniciar
    cargarHistorial();
  </script>
</body>
</html>










