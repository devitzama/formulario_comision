<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario de Comisi√≥n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f4f6f8;
    }
    h1, h2 {
      text-align: center;
      color: #333;
    }
    form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 700px;
      margin: auto;
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-top: 5px;
      box-sizing: border-box;
    }
    button {
      background-color: #007bff;
      color: white;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 15px;
    }
    button:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 40px;
      background: white;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #007bff;
      color: white;
    }
  </style>
</head>
<body>

  <h1>Formulario de Comisi√≥n</h1>

  <form id="comisionForm">
    <label>N√∫mero de Oficio:</label>
    <input type="text" id="oficio" name="oficio" required>

    <label>Fecha:</label>
    <input type="date" id="fechaActual" name="fecha" required>

    <label>Lugar de Comisi√≥n:</label>
    <select id="lugarComision" name="lugarComision" required>
      <option value="">Cargando municipios...</option>
    </select>

    <label>Fecha de Comisi√≥n:</label>
    <input type="date" id="fechaComision" name="fechaComision" required>

    <label>Nombre:</label>
    <input type="text" id="nombre" name="nombre" required>

    <label>Puesto:</label>
    <input type="text" id="puesto" name="puesto" required>

    <label>Qui√©n autoriza:</label>
    <input type="text" id="autoriza" name="autoriza" required>

    <label>Puesto de quien autoriza:</label>
    <input type="text" id="puestoAutoriza" name="puestoAutoriza" required>

    <label>Motivo de la comisi√≥n:</label>
    <textarea id="motivo" name="motivo" rows="3" required></textarea>

    <button type="submit">Guardar</button>
  </form>

  <h2>Historial de Comisiones</h2>
  <table>
    <thead>
      <tr>
        <th>N√∫mero de Oficio</th>
        <th>Fecha</th>
        <th>Lugar de Comisi√≥n</th>
        <th>Fecha de Comisi√≥n</th>
        <th>Nombre</th>
        <th>Puesto</th>
        <th>Autoriza</th>
        <th>Puesto Autoriza</th>
        <th>Motivo</th>
        <th>Marca de Tiempo</th>
      </tr>
    </thead>
    <tbody id="tablaHistorial"></tbody>
  </table>

  <script>
  document.addEventListener("DOMContentLoaded", function() {
    // ‚öôÔ∏è Cambia esta URL por tu Apps Script publicado
    const scriptURL = "https://script.google.com/macros/s/AKfycbzQOYioAaanEqV1PeV4NoY_F6cRkFL1h0iPLIFXQEJ75Fvr8vpeNAJxTDL1vwgDzlBkuA/exec";

    // üìÖ Fecha actual autom√°tica
    const hoy = new Date();
    const offsetMs = hoy.getTimezoneOffset() * 60000;
    const fechaLocal = new Date(hoy.getTime() - offsetMs);
    const fechaISO = fechaLocal.toISOString().split("T")[0];
    document.getElementById("fechaActual").value = fechaISO;
    document.getElementById("fechaComision").value = fechaISO;

    // üèô Cargar municipios desde municipios.txt
    fetch("municipios.txt")
      .then(response => response.text())
      .then(text => {
        const municipios = text.split("\n").map(m => m.trim()).filter(m => m);
        const select = document.getElementById("lugarComision");
        select.innerHTML = "<option value=''>Seleccione un municipio</option>";
        municipios.forEach(nombre => {
          const option = document.createElement("option");
          option.textContent = nombre;
          option.value = nombre;
          select.appendChild(option);
        });
      })
      .catch(err => {
        console.error("Error cargando municipios:", err);
        document.getElementById("lugarComision").innerHTML =
          "<option>Error al cargar municipios</option>";
      });

    // üì• Cargar historial al inicio
    cargarHistorial();

    // üì® Env√≠o del formulario a Google Sheets
    document.getElementById("comisionForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      fetch(scriptURL, { method: 'POST', body: formData })
        .then(() => {
          alert("‚úÖ Datos guardados correctamente");
          this.reset();
          document.getElementById("fechaActual").value = fechaISO;
          document.getElementById("fechaComision").value = fechaISO;
          cargarHistorial();
        })
        .catch(err => alert("‚ùå Error al guardar: " + err.message));
    });

    // üìÑ Funci√≥n para mostrar historial desde Google Sheets
    function cargarHistorial() {
      fetch(scriptURL)
        .then(response => response.json())
        .then(data => {
          const tabla = document.getElementById("tablaHistorial");
          tabla.innerHTML = "";
          if (data.length === 0) {
            tabla.innerHTML = "<tr><td colspan='10'>No hay registros</td></tr>";
            return;
          }
          data.forEach(fila => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${fila["N√∫mero de Oficio"] || ""}</td>
              <td>${fila["Fecha"] || ""}</td>
              <td>${fila["Lugar de Comisi√≥n"] || ""}</td>
              <td>${fila["Fecha de Comisi√≥n"] || ""}</td>
              <td>${fila["Nombre"] || ""}</td>
              <td>${fila["Puesto"] || ""}</td>
              <td>${fila["Autoriza"] || ""}</td>
              <td>${fila["Puesto Autoriza"] || ""}</td>
              <td>${fila["Motivo"] || ""}</td>
              <td>${fila["Marca de Tiempo"] || ""}</td>
            `;
            tabla.appendChild(tr);
          });
        })
        .catch(err => console.error("Error al cargar historial:", err));
    }
  });
  </script>

</body>
</html>



















