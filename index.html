<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario de Comisión</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f4f6f9; }
    form { background: #fff; padding: 20px; border-radius: 10px; max-width: 600px; margin: auto;
           box-shadow: 0px 2px 8px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select, textarea { width: 100%; padding: 10px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { margin-top: 20px; padding: 12px; width: 100%; background: #1976d2; color: white; border: none;
             border-radius: 5px; font-size: 16px; cursor: pointer; }
    button:hover { background: #1565c0; }
  </style>
</head>
<body>
  <h2>Formulario de Comisión</h2>
  <form id="comisionForm">
    <label>Número de Oficio</label>
    <input type="text" name="numeroOficio" required list="historialOficio">
    <datalist id="historialOficio"></datalist>

    <label>Fecha</label>
    <input type="date" name="fecha" id="fechaActual" required>

    <label>Lugar de Comisión</label>
    <select name="lugar" id="lugarSelect" required>
      <option value="">-- Selecciona un lugar --</option>
    </select>

    <label>Fecha de Comisión</label>
    <input type="date" name="fechaC" id="fechaComision" required>

    <label>Nombre</label>
    <input type="text" name="nombre" required list="historialNombre">
    <datalist id="historialNombre"></datalist>

    <label>Puesto</label>
    <input type="text" name="puesto" required list="historialPuesto">
    <datalist id="historialPuesto"></datalist>

    <label>Quién Autoriza</label>
    <input type="text" name="autoriza" required list="historialAutoriza">
    <datalist id="historialAutoriza"></datalist>

    <label>Puesto de Quién Autoriza</label>
    <input type="text" name="puestoAutoriza" required list="historialPuestoAutoriza">
    <datalist id="historialPuestoAutoriza"></datalist>

    <label>Motivo de Comisión</label>
    <textarea name="motivo" rows="3" required></textarea>

    <button type="submit">Enviar</button>
  </form>

  <script>
    // ⚡ URL del WebApp desplegado (Apps Script)
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyPUuTm50w9Gk41xHlLF5iLIVB-v0lwB8Nj1PGAgxRk2Fu5R-6fTaZUrLvN1Z5DGASe4w/exec";

    // ⚡ Cargar municipios desde municipios.txt
    fetch("municipios.txt")
      .then(res => res.text())
      .then(text => {
        const municipios = text.split("\n").map(m => m.trim()).filter(m => m);
        const select = document.getElementById("lugarSelect");
        municipios.forEach(m => {
          let opt = document.createElement("option");
          opt.value = m;
          opt.textContent = m;
          select.appendChild(opt);
        });
      });

    // ⚡ Fecha actual en campo de fecha
    const hoy = new Date().toISOString().split("T")[0];
document.getElementById("fechaActual").value = hoy;
document.getElementById("fechaComision").value = hoy;


    // ⚡ Envío del formulario
    document.getElementById("comisionForm").addEventListener("submit", e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(e.target));

      fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(data)
      })
      .then(res => res.text())
      .then(txt => {
        alert("✅ Datos guardados en el historial");
        e.target.reset();
        document.getElementById("fechaActual").value = new Date().toISOString().split("T")[0];
        document.getElementById("fechaComision").value = new Date().toISOString().split("T")[0];
        cargarHistorial(); // refrescar historial
      })
      .catch(err => alert("❌ Error: " + err));
    });

    // ⚡ Cargar historial desde Google Sheets
    function cargarHistorial() {
      fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
          llenarDatalist("historialOficio", [...new Set(data.map(d => d.numeroOficio))]);
          llenarDatalist("historialNombre", [...new Set(data.map(d => d.nombre))]);
          llenarDatalist("historialPuesto", [...new Set(data.map(d => d.puesto))]);
          llenarDatalist("historialAutoriza", [...new Set(data.map(d => d.autoriza))]);
          llenarDatalist("historialPuestoAutoriza", [...new Set(data.map(d => d.puestoAutoriza))]);
        });
    }

    function llenarDatalist(id, valores) {
      const datalist = document.getElementById(id);
      datalist.innerHTML = "";
      valores.forEach(v => {
        let opt = document.createElement("option");
        opt.value = v;
        datalist.appendChild(opt);
      });
    }

    // ⚡ Cargar historial al iniciar
    cargarHistorial();
  </script>
</body>
</html>







